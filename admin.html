<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Manager with Firebase</title>
    
    <!-- CSS is embedded in the <style> tag -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        #projectForm {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        #projectForm input[type="text"],
        #projectForm input[type="url"] {
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        #projectForm input[type="text"]:focus,
        #projectForm input[type="url"]:focus {
            outline: none;
            border-color: #3498db;
        }

        #saveBtn {
            padding: 12px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #saveBtn:hover {
            background-color: #2980b9;
        }
        
        #cancelBtn {
            padding: 12px 20px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: none; /* Hidden by default */
        }
        
        #cancelBtn:hover {
             background-color: #c0392b;
        }

        #projectList {
            list-style: none;
            padding: 0;
        }

        .project-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }
        
        .project-item:last-child {
            border-bottom: none;
        }

        .project-item:hover {
            background-color: #f9f9f9;
        }

        .project-info a {
            font-weight: 500;
            color: #3498db;
            text-decoration: none;
        }
        
        .project-info a:hover {
            text-decoration: underline;
        }

        .project-info span {
            display: block;
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
            word-break: break-all;
        }

        .project-actions .btn {
            padding: 8px 12px;
            margin-left: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .edit-btn {
            background-color: #f1c40f;
            color: #fff;
        }

        .edit-btn:hover {
            background-color: #f39c12;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: #fff;
        }
        
        .delete-btn:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>My Projects</h1>

        <!-- Form for Creating and Editing Projects -->
        <div class="form-section">
            <h2 id="formTitle">Create New Project</h2>
            <form id="projectForm">
                <input type="hidden" id="projectId" />
                <input type="text" id="projectName" placeholder="Project Name" required />
                <input type="url" id="driveLink" placeholder="Google Drive Link" required />
                <button type="submit" id="saveBtn">Save Project</button>
                <button type="button" id="cancelBtn">Cancel Edit</button>
            </form>
        </div>

        <!-- List of Existing Projects -->
        <div class="list-section">
            <h2>Existing Projects</h2>
            <div id="projectList">
                <!-- Projects will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK Scripts -->
    <!-- We use type="module" to use modern import/export syntax -->
    <script type="module">
        // Import functions from the Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            onSnapshot, 
            doc, 
            updateDoc,
            deleteDoc
        } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB-u3L7Jz3gEfXmfP7-XQfPnI2CwpJM_Vs",
            authDomain: "harsha-demo01.firebaseapp.com",
            projectId: "harsha-demo01",
            storageBucket: "harsha-demo01.firebasestorage.app",
            messagingSenderId: "676891713475",
            appId: "1:676891713475:web:a57e93657253e27a382776",
            measurementId: "G-B211571YB4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const projectsCollection = collection(db, "projects");

        // Get DOM elements
        const projectForm = document.getElementById("projectForm");
        const projectIdInput = document.getElementById("projectId");
        const projectNameInput = document.getElementById("projectName");
        const driveLinkInput = document.getElementById("driveLink");
        const projectList = document.getElementById("projectList");
        const formTitle = document.getElementById("formTitle");
        const saveBtn = document.getElementById("saveBtn");
        const cancelBtn = document.getElementById("cancelBtn");


        // --- REAL-TIME DATA LISTENER ---
        // This function listens for any changes in the 'projects' collection
        // and updates the UI automatically.
        onSnapshot(projectsCollection, (snapshot) => {
            projectList.innerHTML = ''; // Clear the list before re-rendering
            if (snapshot.empty) {
                projectList.innerHTML = '<p>No projects found. Add one above!</p>';
                return;
            }
            snapshot.forEach(doc => {
                const project = doc.data();
                const projectId = doc.id;
                
                const projectItem = document.createElement('div');
                projectItem.className = 'project-item';
                projectItem.innerHTML = `
                    <div class="project-info">
                        <a href="${project.link}" target="_blank" rel="noopener noreferrer">${project.name}</a>
                        <span>${project.link}</span>
                    </div>
                    <div class="project-actions">
                        <button class="btn edit-btn" data-id="${projectId}" data-name="${project.name}" data-link="${project.link}">Edit</button>
                        <button class="btn delete-btn" data-id="${projectId}">Delete</button>
                    </div>
                `;
                projectList.appendChild(projectItem);
            });
        });

        // --- FORM SUBMISSION (CREATE/UPDATE) ---
        projectForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = projectNameInput.value;
            const link = driveLinkInput.value;
            const id = projectIdInput.value;

            if (!name || !link) {
                alert('Please fill in both fields.');
                return;
            }

            try {
                if (id) {
                    // We are updating an existing project
                    const projectDocRef = doc(db, 'projects', id);
                    await updateDoc(projectDocRef, { name, link });
                    console.log("Project updated successfully!");
                } else {
                    // We are creating a new project
                    await addDoc(projectsCollection, { name, link });
                    console.log("Project added successfully!");
                }
                resetForm();
            } catch (error) {
                console.error("Error saving project: ", error);
                alert("Failed to save project.");
            }
        });
        
        // --- EVENT DELEGATION FOR EDIT AND DELETE BUTTONS ---
        projectList.addEventListener('click', (e) => {
            const target = e.target;
            const id = target.dataset.id;

            if (target.classList.contains('edit-btn')) {
                // Handle Edit
                const name = target.dataset.name;
                const link = target.dataset.link;
                
                // Populate the form for editing
                projectIdInput.value = id;
                projectNameInput.value = name;
                driveLinkInput.value = link;

                // Update UI for editing state
                formTitle.textContent = "Edit Project";
                saveBtn.textContent = "Update Project";
                cancelBtn.style.display = 'block';
                window.scrollTo(0, 0); // Scroll to top for better UX
            }
            
            if (target.classList.contains('delete-btn')) {
                // Handle Delete
                if(confirm("Are you sure you want to delete this project?")) {
                    deleteProject(id);
                }
            }
        });
        
        // --- DELETE FUNCTION ---
        async function deleteProject(id) {
            try {
                const projectDocRef = doc(db, 'projects', id);
                await deleteDoc(projectDocRef);
                console.log("Project deleted successfully!");
                resetForm(); // Reset form in case we were editing the deleted item
            } catch (error) {
                console.error("Error deleting project: ", error);
                alert("Failed to delete project.");
            }
        }
        
        // --- CANCEL EDIT ---
        cancelBtn.addEventListener('click', () => {
            resetForm();
        });

        // --- UTILITY FUNCTION TO RESET THE FORM ---
        function resetForm() {
            projectForm.reset();
            projectIdInput.value = '';
            formTitle.textContent = "Create New Project";
            saveBtn.textContent = "Save Project";
            cancelBtn.style.display = 'none';
        }

    </script>
</body>
</html>
